<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>منصة التقييم الذكي لشواهد المعلمين</title>
  <style>
    body {
      font-family: 'Tahoma', sans-serif;
      background: #f0f4f8;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-family: Tahoma;
      margin-bottom: 30px;
      box-shadow: 0 0 10px #ccc;
    }
    th, td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
    }
    th {
      background-color: #27ae60;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
      max-width: 800px;
      margin: auto;
    }
    label, input, textarea {
      display: block;
      width: 100%;
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
    }
    button {
      background-color: #3498db;
      color: white;
      padding: 10px 20px;
      margin-top: 20px;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
    }
    .footer {
      text-align: center;
      margin-top: 40px;
      color: #666;
    }
    @media print {
      .no-print, form, .footer, #loading {
        display: none !important;
      }
      #print-section {
        display: block;
      }
    }
  </style>
</head>
<body>

<h1>منصة التقييم الذكي لشواهد المعلمين</h1>

<!-- نموذج الإدخال -->
<form method="POST" enctype="multipart/form-data" onsubmit="document.getElementById('loading').style.display = 'block';">
  <label>اسم المعلم:</label>
  <input type="text" name="teacher_name" value="{{ teacher_name }}">
  <label>المدرسة:</label>
  <input type="text" name="school" value="{{ school }}">
  <label>المسمى الوظيفي:</label>
  <input type="text" name="job_title" value="{{ job_title }}">
  <label>اسم المدير:</label>
  <input type="text" name="principal_name" value="{{ principal_name }}">
  <label>نص الشاهد:</label>
  <textarea name="shahid" rows="5"></textarea>
  <label>أو ارفع صورة:</label>
  <input type="file" name="image">
  <label>أو ارفع ملف PDF:</label>
  <input type="file" name="pdf_file">
  <button type="submit">تحليل الشاهد</button>
</form>

<div id="loading" style="display:none; text-align:center; margin-top:20px;">جاري التحليل... يرجى الانتظار</div>

{% if gpt_result %}
<div id="print-section">
  <h2>نتيجة التحليل الذكي:</h2>

  <!-- جدول العناصر الرسمية -->
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>اسم العنصر</th>
        <th>درجة التحقق</th>
        <th>النسبة المحققة حسب الوزن</th>
      </tr>
    </thead>
    <tbody>
      {% for idx, item in enumerate(gpt_result['elements'], start=1) %}
      <tr>
        <td>{{ idx }}</td>
        <td>{{ item['name'] }}</td>
        <td>{{ item['score'] }}</td>
        <td>{{ item['percentage'] }}%</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- الدرجة النهائية والنسبة الإجمالية -->
  {% if final_score %}
  <table style="width: 300px; margin: 30px auto;">
    <tr style="background-color: #27ae60; color: white;">
      <th>الدرجة النهائية من 5</th>
      <th>النسبة المئوية</th>
    </tr>
    <tr>
      <td><strong>{{ final_score }}</strong></td>
      <td><strong>{{ final_percentage }}%</strong></td>
    </tr>
  </table>
  {% endif %}

  <!-- ملاحظات تحليلية -->
  <div style="white-space: pre-wrap; font-size: 17px;">
    <h3>الملاحظات التحليلية:</h3>
    <ul>
      {% for note in gpt_result['notes'] %}
      <li>{{ note }}</li>
      {% endfor %}
    </ul>
  </div>

  <div style="text-align: center; font-size: 18px; margin-top: 30px;">
    <p><strong>اسم المعلم:</strong> {{ teacher_name }}</p>
    <p><strong>اسم المدير:</strong> {{ principal_name }}</p>
    <p><strong>التوقيع:</strong> _______________________</p>
  </div>
</div>
{% endif %}

<div class="footer no-print">
  <p>تصميم و 
